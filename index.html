<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>HUIUCL Database v4.0</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --header-bg: #2d2d2d;
            --accent: #d4a373;
            --text: #333;
            --border: #e9ecef;
        }

        body { font-family: 'Pretendard', -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        
        /* UI 복구 및 개선 */
        nav { background: var(--header-bg); padding: 1rem; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        nav .nav-container { max-width: 1200px; margin: 0 auto; display: flex; gap: 20px; }
        nav a { color: #fff; text-decoration: none; font-weight: 500; cursor: pointer; opacity: 0.8; transition: 0.3s; }
        nav a:hover { opacity: 1; color: var(--accent); }

        header { background: #fff; padding: 40px 20px; text-align: center; border-bottom: 1px solid var(--border); }
        h1 { margin: 0; letter-spacing: 10px; font-weight: 300; color: #1a1a1a; }
        .version { font-size: 0.8rem; color: #aaa; margin-top: 10px; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        .search-wrapper { margin-bottom: 30px; position: relative; }
        .search-box { width: 100%; padding: 18px 25px; border: 1px solid #ddd; border-radius: 50px; font-size: 1.1rem; box-sizing: border-box; outline: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: 0.3s; }
        .search-box:focus { border-color: var(--accent); box-shadow: 0 4px 20px rgba(212, 163, 115, 0.2); }

        .table-card { background: #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th { background: #fdfcfb; padding: 18px; text-align: left; font-size: 0.85rem; color: #888; text-transform: uppercase; border-bottom: 2px solid var(--border); }
        td { padding: 20px; border-bottom: 1px solid var(--border); vertical-align: top; word-break: break-all; }

        .word-cell { width: 20%; font-size: 1.15rem; font-weight: 700; color: #1a1a1a; }
        .meaning-cell { width: 60%; }
        .cat-cell { width: 20%; text-align: right; font-size: 0.75rem; color: #bbb; }

        .ko-text { font-size: 1.05rem; font-weight: 600; color: var(--accent); margin-bottom: 5px; }
        .en-text { font-size: 0.95rem; color: #666; }
        .usage-box { margin-top: 12px; padding: 10px; background: #f9f9f9; border-radius: 6px; border-left: 3px solid #ddd; font-size: 0.85rem; color: #777; }
        
        .sub-row { background: #fcfcfc; }
        .sub-mark { color: var(--accent); margin-right: 5px; }

        section { display: none; }
        section.active { display: block; }
    </style>
</head>
<body>

<nav>
    <div class="nav-container">
        <a onclick="showTab('dictionary')">DICTIONARY</a>
        <a onclick="showTab('grammar')">GRAMMAR</a>
    </div>
</nav>

<header>
    <h1>HUIUCL</h1>
    <div class="version">CORE ARCHIVE v4.0 (STRICT MAPPING)</div>
</header>

<div class="container">
    <section id="dictionary" class="active">
        <div class="search-wrapper">
            <input type="text" id="searchInput" class="search-box" placeholder="단어, 뜻, 파생어, 분류를 입력하세요..." oninput="render()">
        </div>
        <div class="table-card">
            <table>
                <thead>
                    <tr>
                        <th>Word</th>
                        <th>Meaning & Usage</th>
                        <th style="text-align:right">Category</th>
                    </tr>
                </thead>
                <tbody id="dictBody"></tbody>
            </table>
        </div>
    </section>

    <section id="grammar">
        <div id="grammarContent"></div>
    </section>
</div>

<script>
    let rawData = {};

    function showTab(id) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    window.onload = () => {
        fetch('Huiucl.json').then(res => res.json()).then(data => {
            rawData = data;
            render();
        });
    };

    function render() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const body = document.getElementById('dictBody');
        body.innerHTML = '';

        for (const cat in rawData) {
            if (cat === "Settings") continue;
            deepSearch(rawData[cat], cat, query);
        }
    }

    function deepSearch(obj, path, query) {
        if (path.includes("Grammar_Rules")) return;

        for (const key in obj) {
            const val = obj[key];
            if (!val) continue;

            // 1. 단어 데이터 판별 로직 (morpheme sa- 같은 케이스 대응)
            const info = extractInfo(key, val);

            if (info.isWord) {
                if (match(info.word, info.ko, info.en, path, query)) {
                    append(info.word, info.ko, info.en, info.usage, path);
                }
                
                // 파생어 처리
                if (val.derivations) {
                    for (const dk in val.derivations) {
                        append(dk, val.derivations[dk], "", "", path, true);
                    }
                }

                // 시제 변형(tense_variants) 등 내부 재귀
                if (typeof val === 'object' && val.tense_variants) {
                    deepSearch(val.tense_variants, path + " > " + key, query);
                }
            } 
            // 2. 하위 카테고리인 경우 계속 탐색
            else if (typeof val === 'object') {
                deepSearch(val, path + " > " + key, query);
            }
        }
    }

    function extractInfo(key, val) {
        let res = { isWord: false, word: key, ko: "", en: "", usage: "" };

        // 케이스 A: 단순 문자열 (Pronouns 등)
        if (typeof val === 'string') {
            res.isWord = true;
            res.ko = val;
        } 
        // 케이스 B: 객체형 (Auxiliary_Verbs, Affixes 등)
        else if (typeof val === 'object') {
            // morpheme: "sa-" 같은 역구조 대응
            if (val.morpheme) {
                res.word = val.morpheme;
                res.ko = val.meaning_ko || val.ko || val.definition || "";
                res.en = val.meaning_en || val.en || "";
            } else {
                res.ko = val.meaning_ko || val.ko || val.뜻 || val.definition || "";
                res.en = val.meaning_en || val.en || "";
            }
            res.usage = val.usage || val.note || "";
            
            // ko나 en이 오브젝트로 나오는 것 방지
            if (typeof res.ko === 'object') res.ko = res.ko.ko || res.ko.meaning_ko || "";
            if (typeof res.en === 'object') res.en = res.en.en || res.en.meaning_en || "";

            if (res.ko || res.en) res.isWord = true;
        }
        return res;
    }

    function match(w, k, e, p, q) {
        return (w+k+e+p).toLowerCase().includes(q);
    }

    function append(w, ko, en, use, path, isSub) {
        const body = document.getElementById('dictBody');
        const row = body.insertRow();
        if (isSub) row.className = 'sub-row';

        let meaning = `<div class="ko-text">${ko}</div>`;
        if (en) meaning += `<div class="en-text">${en}</div>`;
        if (use) {
            const useStr = typeof use === 'object' ? (use.ko || use.en || JSON.stringify(use)) : use;
            meaning += `<div class="usage-box"><strong>USAGE:</strong> ${useStr}</div>`;
        }

        row.innerHTML = `
            <td class="word-cell">${isSub ? '<span class="sub-mark">↳</span>' : ''}${w}</td>
            <td class="meaning-cell">${meaning}</td>
            <td class="cat-cell">${path}</td>
        `;
    }
</script>
</body>
</html>
