<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Huiucl Auto-Load Dictionary</title>
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --bg: #f8f9fa; --card: #ffffff; }
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; background: var(--bg); padding: 20px; color: var(--primary); }
        .container { max-width: 900px; margin: 0 auto; }
        
        /* ë¡œë”© ìƒíƒœ í‘œì‹œ */
        #loader { text-align: center; padding: 20px; font-weight: bold; color: #2980b9; }
        
        /* í—¤ë” ì„¹ì…˜ */
        .header-panel { background: var(--primary); color: white; padding: 30px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .header-panel h1 { margin: 0; font-size: 32px; letter-spacing: 1px; }
        
        /* ê²€ìƒ‰ì°½ */
        .search-container { position: sticky; top: 15px; z-index: 1000; margin-bottom: 30px; }
        .search-input { width: 100%; padding: 20px 25px; font-size: 22px; border: 4px solid #ddd; border-radius: 50px; box-sizing: border-box; outline: none; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transition: all 0.3s ease; }
        .search-input:focus { border-color: var(--accent); transform: translateY(-2px); }

        /* ê²°ê³¼ ì¹´ë“œ */
        .card { background: var(--card); border-radius: 15px; padding: 30px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); border-left: 8px solid #dcdde1; transition: transform 0.2s; }
        .card:hover { transform: scale(1.01); }
        .card.exact { border-left-color: var(--accent); }
        
        .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 10px; }
        .badge-cat { background: #f1f2f6; color: #7f8c8d; }
        .badge-exact { background: var(--accent); color: white; margin-left: 10px; }
        
        .word-row { display: flex; align-items: baseline; gap: 15px; flex-wrap: wrap; }
        .word-text { font-size: 32px; font-weight: 900; color: #2980b9; text-transform: uppercase; }
        .meaning-text { font-size: 20px; color: #2c3e50; font-weight: 600; }
        .meaning-en { color: #95a5a6; font-size: 16px; font-style: italic; }

        /* ë°ì´í„° ê·¸ë¦¬ë“œ (íŒŒìƒì–´, ë³€ì´í˜•) */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        .data-list { background: #fdfdfd; border: 1px solid #f1f1f1; border-radius: 10px; padding: 15px; }
        .list-title { font-size: 14px; font-weight: bold; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 10px; }
        .item-row { display: flex; font-size: 14px; margin-bottom: 4px; }
        .item-key { font-weight: bold; width: 110px; color: #e67e22; }

        /* ìƒì„¸ ì •ë³´ (ê²€ìƒ‰ ì œì™¸ êµ¬ì—­) */
        .details { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #eee; font-size: 14px; color: #555; }
        .detail-item { margin-bottom: 5px; }
        .label { font-weight: bold; color: #7f8c8d; margin-right: 5px; }
        .example-box { color: #2980b9; background: #ebf5fb; padding: 10px; border-radius: 5px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-panel">
        <h1>Huiucl Engine <small style="font-size: 14px; opacity: 0.8;">v3.0 Auto-Load</small></h1>
        <div id="loader">âš™ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <div class="search-container">
        <input type="text" id="query" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (su, a, mi, ì œì‘í•˜ë‹¤...)" onkeyup="search()">
    </div>

    <div id="results"></div>
</div>

<script>
let lexicon = {};

// [ìë™ ë¡œë“œ] í˜ì´ì§€ ë¡œë“œ ì‹œ Huiucl.json íŒŒì¼ì„ ì¦‰ì‹œ ì½ì–´ì˜´
window.onload = async function() {
    try {
        const response = await fetch('Huiucl.json');
        if (!response.ok) throw new Error('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        const data = await response.json();
        
        process(data);
        
        document.getElementById('loader').innerText = `âœ… ${Object.keys(lexicon).length}ê°œ í•­ëª© ë¡œë“œ ì™„ë£Œ. ë°”ë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
        setTimeout(() => document.getElementById('loader').style.display = 'none', 3000);
    } catch (err) {
        document.getElementById('loader').innerHTML = `âŒ ì˜¤ë¥˜: ${err.message}<br><small>Huiucl.json íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</small>`;
    }
};

function process(obj, parentKey = null, currentCat = null) {
    if (typeof obj !== 'object' || obj === null) return;

    // 1. ëŒ€ëª…ì‚¬ ì„¹ì…˜ (a, i, u ë“± í•œ ê¸€ì ëŒ€ëª…ì‚¬ ì™„ë²½ ë¡œë“œ)
    const pSects = ["1st_Person", "2nd_Person", "3rd_Person", "Demonstratives"];
    if (pSects.includes(parentKey)) {
        for (const [pk, pv] of Object.entries(obj)) {
            lexicon[pk] = {
                meaning_ko: pv,
                _category: `Pronoun (${parentKey})`,
                _search_target: `${pk} ${pv}`.toLowerCase()
            };
        }
        return;
    }

    // 2. ì¼ë°˜ ë‹¨ì–´ ì²˜ë¦¬
    const keys = ['meaning_ko', 'ko', 'definition', 'morpheme', 'meaning_en', 'en'];
    const hasInfo = keys.some(k => k in obj);

    if (hasInfo && parentKey) {
        let entry = { ...obj };
        if (entry.definition && typeof entry.definition === 'object') Object.assign(entry, entry.definition);

        // [ì¤‘ìš”] ê²€ìƒ‰ íƒ€ê²Ÿì—ì„œ usage, exampleì€ ì œê±° (ì˜¤ë¡œì§€ ë‹¨ì–´ëª…ê³¼ ëœ»ë§Œ)
        let targets = [parentKey];
        keys.forEach(k => { if (entry[k]) targets.push(entry[k]); });
        
        entry._category = currentCat;
        entry._search_target = targets.join(" ").toLowerCase();
        lexicon[parentKey] = entry;
    }

    for (const [k, v] of Object.entries(obj)) {
        if (typeof v === 'object') {
            const nextCat = (parentKey === null) ? k : currentCat;
            if (k !== 'Settings') process(v, k, nextCat);
        }
    }
}

function search() {
    const q = document.getElementById('query').value.trim().toLowerCase();
    const resDiv = document.getElementById('results');
    resDiv.innerHTML = '';
    if (!q) return;

    let found = [];
    // ì •í™•í•œ ë…ë¦½ í˜•íƒœì†Œ ì¸ì§€ë¥¼ ìœ„í•œ ì •ê·œì‹
    const re = new RegExp(`(^|[^a-zA-Zê°€-í£])${q}($|[^a-zA-Zê°€-í£])`, 'i');

    for (const [word, info] of Object.entries(lexicon)) {
        const wordL = word.toLowerCase();
        const target = info._search_target || "";

        if (q === wordL) found.push({ word, info, score: 2 });
        else if (re.test(target) || (q.length > 1 && target.includes(q))) found.push({ word, info, score: 1 });
    }

    found.sort((a, b) => b.score - a.score).forEach(item => {
        const info = item.info;
        const card = document.createElement('div');
        card.className = `card ${item.score === 2 ? 'exact' : ''}`;

        // íŒŒìƒì–´/ë³€ì´í˜• ê·¸ë¦¬ë“œ ìƒì„±
        let gridHtml = '';
        const derivs = info.derivations || info.derivation;
        if (derivs) {
            gridHtml += `<div class="data-list"><div class="list-title">ğŸ“‚ ê¸°ë¡ëœ íŒŒìƒì–´</div>`;
            for(const [dw, dm] of Object.entries(derivs)) gridHtml += `<div class="item-row"><span class="item-key">${dw}</span> <span>${dm}</span></div>`;
            gridHtml += `</div>`;
        }

        let vars = {};
        ["tense_variants", "aspect_voice", "variants"].forEach(k => { if(info[k]) Object.assign(vars, info[k]); });
        if (Object.keys(vars).length > 0) {
            gridHtml += `<div class="data-list"><div class="list-title">ğŸ“‚ ì‹œì œ ë° ë³€ì´</div>`;
            for(const [vw, vi] of Object.entries(vars)) gridHtml += `<div class="item-row"><span class="item-key">${vw}</span> <span>${vi.meaning_ko || vi.ko || ''}</span></div>`;
            gridHtml += `</div>`;
        }

        card.innerHTML = `
            <span class="badge badge-cat">${info._category}</span>
            ${item.score === 2 ? '<span class="badge badge-exact">ì •í™•í•œ ì¼ì¹˜</span>' : ''}
            <div class="word-row">
                <span class="word-text">${item.word}</span>
                <span class="meaning-text">${info.meaning_ko || info.ko || info.morpheme || ''}</span>
                <span class="meaning-en">${info.meaning_en || info.en || ''}</span>
            </div>
            <div class="grid-container">${gridHtml}</div>
            <div class="details">
                ${info.usage ? `<div class="detail-item"><span class="label">ğŸ“ ìš©ë²•:</span> ${typeof info.usage === 'object' ? info.usage.ko : info.usage}</div>` : ''}
                ${info.note ? `<div class="detail-item"><span class="label">ğŸ’¡ ì°¸ê³ :</span> ${info.note}</div>` : ''}
                ${info.example ? `<div class="example-box"><span class="label">ğŸ“– ì˜ˆë¬¸:</span> ${info.example}</div>` : ''}
            </div>
        `;
        resDiv.appendChild(card);
    });
}
</script>
</body>
</html>